---
import Code from './Code.astro';

const coreExample = `import { graph } from '@3plate/graph-core';

await graph({
  root: 'app',
  nodes: ['a', 'b', 'c', 'd'],
  edges: ['a->b', 'a->c', 'b->d', 'c->d']
});`;
---

<div class="demo-wrapper">
  <div class="demo-info">
    <h3>Core Implementation</h3>
    <p>
      Using <code>@3plate/graph-core</code> package (vanilla JS)
    </p>
  </div>

  <div class="graph-container" id="core-graph-container">
    <!-- Graph will be rendered here -->
  </div>

  <div class="code-example">
    <h4>Usage Example</h4>
    <Code code={coreExample} lang="typescript" />
  </div>
</div>

<style>
  .graph-container {
    width: 100%;
    height: 400px;
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    margin: 1rem 0;
    overflow: hidden;
  }
</style>

<script>
  import { graph } from '@3plate/graph-core';

  async function initCoreDemo() {
    const container = document.getElementById('core-graph-container');
    if (!container) return;

    // Clear any existing content
    container.innerHTML = '';

    try {
      await graph({
        root: 'core-graph-container',
        nodes: ['a', 'b', 'c', 'd'],
        edges: ['a->b', 'a->c', 'b->d', 'c->d'],
      });
    } catch (e) {
      console.error('Failed to initialize core demo:', e);
      container.innerHTML = '<p style="padding: 2rem; color: #ef4444;">Failed to load graph</p>';
    }
  }

  // Initialize when the tab becomes visible
  document.addEventListener('DOMContentLoaded', () => {
    const coreTab = document.querySelector('[data-tab="core"]');
    const corePanel = document.querySelector('[data-panel="core"]');
    
    if (coreTab && corePanel) {
      // Check if already active
      if (corePanel.classList.contains('active')) {
        initCoreDemo();
      }
      
      // Initialize when tab is clicked
      coreTab.addEventListener('click', () => {
        setTimeout(initCoreDemo, 100);
      });
    }
  });
</script>
